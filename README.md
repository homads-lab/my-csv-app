# 統計解析アプリ（Streamlit + PostgreSQL on AppRun(β)）

## アプリ概要
AppRun(β)上にデプロイされている、表形式のデータを表示・分析できるWebアプリです。  
データベースにはPostgreSQLを使用し、StreamlitでUIを構築しています。

## 目的
このアプリは、PythonとDockerを用いたWebアプリケーション開発の実践経験と、
クラウドへのデプロイ・外部データベース連携の理解を深めることを目的としています。

## 公開URL
https://app-4eda905f-a694-467a-a184-5eb87b8aa3a3.ingress.apprun.sakura.ne.jp  
⚠️外部データベースの無料期限が2025年7月24日までのため、それ以降はデータベース連携が使えません。

## 使い方
1. ページにアクセスすると、CSVファイルをアップロードする箇所があり、ファイルを読み込むことで各種分析ができます。  テスト用として、リポジトリ内にサンプルCSVファイル（`db/sample.csv`）を含めているので、ダウンロードして簡単に試すことができます。
2. または、画面左側のサイドバーから、データの取得元を「PostgreSQL」に変更することで、データベース内の `users` テーブルが自動的に読み込まれます。
3. データ読み込み後、サイドバーから以下の分析項目をチェックして表示／非表示を切り替えられます。
   - 基本統計量の表示
   - 欠損値チェック
   - ヒストグラムの表示
   - 相関行列ヒートマップの表示
   - 散布図（X軸・Y軸を選択可能）

## 初期データ(DBの中身)
以下の初期データがusersテーブルに含まれています：

| id | name | age | height |
|----|------|-----|--------|
| 1  | 田中 | 25  | 170.5  |
| 2  | 佐藤 | 30  | 165.2  |
| 3  | 鈴木 | 22  | 158.8  |

## 使用技術
- Python 3.10  
- Streamlit  
- PostgreSQL 15 (Renderの無料プラン)  
- Docker / Docker Compose (開発用)  
- Render(DBホスティング)  
- AppRun(β)

## フォルダ構成
```
my-csv-app/
├── app.py                  # Streamlitアプリのメインスクリプト
├── Dockerfile              # Dockerイメージ構築用ファイル
├── docker-compose.yml      # 複数コンテナの構成定義
├── requirements.txt        # Python依存パッケージの一覧
├── .dockerignore           # Dockerビルド時に無視するファイル
├── .gitignore              # Git管理外とするファイル定義
├── .env.example            # 環境変数のテンプレートファイル
├── README.md               # プロジェクトの概要説明（本ファイル）
└── db/
    └── init.sql            # データベース初期化用SQLスクリプト
    └── sample.csv          # サンプルデータ
```
### 補足
このリポジトリには、ローカル環境での動作確認を目的として、PostgreSQLデータベースをDockerコンテナで構築する設定ファイル（db/init.sql、docker-compose.yml）を同梱しています。  
ただし、実際にインターネット上で公開している本番アプリケーションでは、外部サービス（RenderのPostgreSQL）を使用しており、このローカル用のデータベース設定は本番環境では使用していません。  
docker-compose.yml や db/init.sql はあくまで ローカル開発・動作確認用 です。  
.env.example には、本番環境用とローカル環境用の両方の変数が含まれています。実行時には適切な.envを作成し、接続情報を設定してください。  
このように分離することで、ローカル環境と本番環境の切り替えがしやすく、環境構築しやすくなるよう配慮しています。

## 環境構築
### 1. リポジトリをクローン
```
git clone https://github.com/homads-lab/my-csv-app.git  
cd my-csv-app
```

### 2. 環境変数ファイルを作成
.env.example を参考に .env ファイルを作成

### 3.環境変数の読み込み
ローカルで実行する際には、app.py 内の以下のコメントアウトされた行を有効化してください
```
# app.py の先頭付近
# from dotenv import load_dotenv
# load_dotenv()
```
↓ 以下のように変更
```
from dotenv import load_dotenv
load_dotenv()
```

### 4. Dockerで立ち上げ（ローカル用）
```
docker-compose up --build
```

## 現在できること
- データベースまたはアップロードしたCSVファイルからデータを読み込み
- 基本統計量（平均、中央値、標準偏差など）の表示
- 欠損値の有無を自動チェック
- ヒストグラムによる変数分布の可視化
- 相関行列ヒートマップの表示（数値変数同士の関係性を視覚化）
- 散布図の描画（任意の変数を選んでプロット可能）
- すべての項目はサイドバーのチェック操作で表示・非表示を簡単に切り替え可能

## 本番環境での構成(AppRun)
- Webアプリ：DockerfileをAppRun(β)でビルドしデプロイ
- データベース：RenderのPostgreSQL（無料枠）
- 環境変数：AppRunの設定画面から設定

## 今後の課題・展望
- Webアプリ上でのデータベース操作機能（追加・編集・削除などのCRUD処理）
- 各種統計的検定や機械学習モデルの推定の機能